{{!-- Eon IV Combat Tracker - Phases Panel --}}

<div class="eon-phases-container">
  {{#if hasCombat}}
    {{!-- Header with round info and controls --}}
    <header class="eon-phases-header">
      <h2>Runda {{round}}</h2>
      {{#if canModify}}
        <div class="eon-header-controls">
          <button type="button" data-action="clear-all" title="Återställ alla faser">
            <i class="fas fa-undo"></i> Återställ
          </button>
        </div>
      {{/if}}
    </header>

    {{!-- Phase list (vertical stack) --}}
    <div class="eon-phases-list">
      {{#each phases}}
        <div class="eon-phase-section" data-phase="{{id}}">
          <div class="eon-phase-header">
            <div class="eon-phase-header-left" data-action="toggle-phase">
              <i class="fas {{icon}}"></i>
              <span class="eon-phase-title">{{label}}</span>
              <span class="eon-phase-count">{{count}}</span>
            </div>
            <div class="eon-phase-header-right">
              <i class="fas fa-chevron-down eon-phase-toggle" data-action="toggle-phase"></i>
            </div>
          </div>
          
          <ul class="eon-combatant-list" data-phase="{{id}}">
            {{#each combatants}}
              <li class="eon-combatant-row {{#if defeated}}defeated{{/if}} {{#if meleeRole}}melee-{{meleeRole}}{{/if}}" 
                  data-combatant-id="{{id}}"
                  data-phase="{{../id}}"
                  draggable="true">
                {{#if meleeRole}}
                  {{#if isAttacker}}
                    <i class="fas fa-sword eon-melee-role-icon eon-attacker-icon" title="Anfallare"></i>
                  {{/if}}
                  {{#if isDefender}}
                    <i class="fas fa-shield eon-melee-role-icon eon-defender-icon" title="Försvarare"></i>
                  {{/if}}
                {{/if}}
                <img class="eon-combatant-img" src="{{img}}" alt="{{name}}">
                <span class="eon-combatant-name">{{name}}</span>
                {{#if ../canModify}}
                  <button type="button" 
                          class="eon-roll-reaction-btn" 
                          data-action="roll-reaction" 
                          data-combatant-id="{{id}}"
                          title="Slå Reaktion">
                    <i class="fas fa-dice"></i>
                  </button>
                {{/if}}
                {{#if reactionRoll}}
                  <span class="eon-reaction-roll" title="Reaktionsslag: {{reactionRoll}}">{{reactionRoll}}</span>
                {{/if}}
                {{#if defeated}}
                  <i class="fas fa-skull eon-defeated-icon" title="Besegrad"></i>
                {{/if}}
              </li>
            {{else}}
              <li class="eon-combatant-empty">
                <em>Ingen i denna fas</em>
              </li>
            {{/each}}
          </ul>
        </div>
      {{/each}}
    </div>

  {{else}}
    {{!-- No active combat --}}
    <div class="eon-no-combat">
      <i class="fas fa-exclamation-triangle"></i>
      <p>Ingen aktiv strid.</p>
      <p class="eon-hint">Starta en strid för att använda stridshanteraren.</p>
    </div>
  {{/if}}
</div>

